<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vertretungsplan</title>
    <link id="theme-css" href="/default.css" rel="stylesheet" type="text/css">
</head>
<style>
    * {
        font-family: Arial, serif;
        transition: background-color 0.1s;
    }

    .loading-text {
        color: lightgrey;
    }

    body {
        background-color: var(--background-color);
        /*darkslategrey*/
        background-image: url("https://pipeman.org/pipe.svg");
        background-size: 30px;
    }

    .plan-div {
        transform: translate(-40px, -40px) scale(0.8);
        transform-origin: 0 0;
    }

    .tomorrow {
        transform: translate(-250px, -40px) scale(0.8);
        transform-origin: 0 0
    }

    .plan-div-no-translate {
        transform: translate(-120px, -40px) scale(0.8);
        transform-origin: 0 0;
    }

    .tomorrow-no-translate {
        transform: translate(-120px, -320px) scale(0.8);
        transform-origin: 0 0
    }

    .header {
        text-align: left;
        color: var(--header-color);
        padding-left: 15px;
        font-size: 25px;
    }

    #sp-div {
        display: flex;
        width: 1000px;
        flex-direction: row;
        align-items: center
    }

    .theme-button {
        line-height: 41px;
        height: 37px;
        width: 37px;
        font-size: 2em;
        border-radius: 50%;
        background-color: var(--header-color);
        cursor: pointer;
        border: none;
        align-self: center;
    }

    .no-hover {
        pointer-events: none;
    }

    .header-wrapper {
        display: flex;
        gap: 1rem;
    }
</style>
<body>
<div class="header-wrapper">
    <h2 class="header">WLS-Vertretungsplan</h2>
    <button class="theme-button" id="theme-button" onclick="toggleTheme()">
    </button>
</div>

<div id="loading-div" style="text-align: center; width: 300px" hidden>
    <img style="margin: auto" src="loading-137px.gif" alt="Loading-Gif">
    <h2 class="loading-text">LÃ¤dt...</h2>
</div>
<div id="sp-div">
    <div class="no-hover plan-div" id="today">

    </div>
    <div class="no-hover tomorrow" id="tomorrow">

    </div>
</div>
</body>
<script>
    let todayReady = false;
    let tomorrowReady = false;
    const moon = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="var(--text-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class=""><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>';
    const sun = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="var(--text-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class=""><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>';

    const delay = setTimeout(() => {
        setLoading(true);
    }, 100);

    function toggleTheme() {
        const mode = !isLightMode();
        localStorage.setItem("theme", mode ? "default" : "dark");
        setTheme(mode);
    }

    function isLightMode() {
        if (localStorage.getItem("theme") === "dark") return false;
        else {
            localStorage.setItem("theme", "default");
            return true;
        }
    }

    function setTheme(lightMode) {
        document.getElementById("theme-css").href = lightMode ? "/default.css" : "/dark.css";
        document.getElementById("theme-button").innerHTML = lightMode ? moon : sun;
    }

    function setLoading(loading) {
        document.getElementById("loading-div").hidden = !loading;
    }

    function onLoadEnd() {
        onResize();
        if (todayReady && tomorrowReady) {
            setLoading(false);
            clearTimeout(delay);
        }
    }

    function getPlans() {
        fetch("api/plans/today?format=html").then(response => {
            response.text().then(text => {
                document.getElementById("today").innerHTML = text;
                todayReady = true;
                onLoadEnd();
            });
        });

        fetch("api/plans/tomorrow?format=html").then(response => {
            response.text().then(text => {
                document.getElementById("tomorrow").innerHTML = text;
                tomorrowReady = true;
                onLoadEnd();
            });
        });
    }

    function onResize() {
        // 1140
        if (window.innerWidth < 1140) {
            document.getElementById("sp-div").style.flexDirection = "column";

            document.getElementById("today").classList.remove("plan-div");
            document.getElementById("today").classList.add("plan-div-no-translate");
            document.getElementById("tomorrow").classList.remove("tomorrow");
            document.getElementById("tomorrow").classList.add("tomorrow-no-translate");
        } else {
            document.getElementById("sp-div").style.flexDirection = "row";

            document.getElementById("today").classList.add("plan-div");
            document.getElementById("today").classList.remove("plan-div-no-translate");
            document.getElementById("tomorrow").classList.add("tomorrow");
            document.getElementById("tomorrow").classList.remove("tomorrow-no-translate");
        }
    }

    window.addEventListener('resize', () => {
        onResize();
    });

    setTheme(isLightMode());
    getPlans();
</script>
</html>
